<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>App Builder — Export ZIP with TTS App</title>
<style>
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:20px;background:#0f172a;color:#e6eef6}
  .card{background:#081226;padding:18px;border-radius:12px;max-width:980px;margin:auto;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
  input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit}
  label{font-size:13px;color:#94a3b8}
  .row{display:flex;gap:10px}
  button{background:linear-gradient(90deg,#06b6d4,#7c3aed);border:0;padding:10px 14px;border-radius:10px;color:white;cursor:pointer}
  footer{color:#94a3b8;margin-top:12px;font-size:13px}
  pre{background:#061021;padding:12px;border-radius:8px;overflow:auto}
</style>
</head>
<body>
<div class="card">
  <h2>Simple App Builder — exports a ZIP with a TTS-enabled app</h2>
  <p class="muted">Fill the fields below, then click <strong>Generate ZIP</strong>. The generated ZIP contains a ready-to-run HTML app with Text-to-Speech built-in.</p>

  <label>App Name</label>
  <input id="appName" value="My TTS App"/>

  <label>App Description</label>
  <input id="appDesc" value="A small app generated with TTS support."/>

  <label>Primary Color (hex)</label>
  <input id="appColor" value="#06b6d4"/>

  <label>Include features</label>
  <div class="row" style="margin-bottom:8px">
    <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="featNotes" checked/> Notes</label>
    <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="featRecorder" checked/> Recorder</label>
    <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="featSTT" checked/> Speech-to-Text</label>
  </div>

  <label>Filename for ZIP</label>
  <input id="zipName" value="my-tts-app.zip"/>

  <div style="margin-top:12px">
    <button id="genBtn">Generate ZIP</button>
  </div>

  <hr style="margin:14px 0;border:0;border-top:1px solid rgba(255,255,255,0.04)"/>

  <div id="status" style="font-size:13px;color:#94a3b8">Status: waiting</div>
  <div id="downloadArea" style="margin-top:10px"></div>

  <h3 style="margin-top:18px">Generated app preview (index.html)</h3>
  <pre id="preview" style="height:260px"></pre>

  <footer>
    Notes: The generator runs entirely in the browser (uses JSZip). To publish the generated app, host the files on HTTPS or wrap in WebView/TWA for Android.
  </footer>
</div>

<!-- JSZip CDN -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
const genBtn = document.getElementById('genBtn');
const status = document.getElementById('status');
const downloadArea = document.getElementById('downloadArea');
const preview = document.getElementById('preview');

function makeIndexHTML(opts){
  // Minimal TTS-enabled app template
  const {name, desc, color, notes, recorder, stt} = opts;
  return `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${name}</title>
<style>
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:16px;background:linear-gradient(180deg,#061021,#081226);color:#e6eef6}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0}
  .card{background:rgba(255,255,255,0.03);padding:12px;border-radius:12px;margin-top:12px}
  textarea{width:100%;height:160px;padding:10px;border-radius:8px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.03);color:inherit}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{background:${color};border:0;padding:8px 12px;border-radius:8px;color:#041024;cursor:pointer}
  .muted{color:#94a3b8;font-size:13px}
</style>
</head>
<body>
<header><h1>${name}</h1></header>
<div class="card">
  <div class="muted">${desc}</div>
  <label style="display:block;margin-top:8px">Text to speak</label>
  <textarea id="text">Hello — this is your generated app. Press Speak to hear me.</textarea>
  <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
    <select id="voices"></select>
    <input id="rate" type="range" min="0.5" max="2" step="0.1" value="1"/>
    <button id="speak">Speak</button>
    <button id="stop">Stop</button>
  </div>

  ${notes ? `<div style="margin-top:12px"><button id="saveNote">Save Note</button></div><div id="notesList" style="margin-top:8px"></div>` : ''}
  ${recorder ? `<div style="margin-top:12px"><button id="recStart">Record</button><button id="recStop">Stop</button><div id="recs"></div></div>` : ''}
  ${stt ? `<div style="margin-top:12px"><button id="sttStart">Start Dictation</button><button id="sttStop">Stop Dictation</button><div id="sttStatus" class="muted">STT: idle</div></div>` : ''}
</div>

<script>
/* TTS */
const synth = window.speechSynthesis;
let voices=[];
function populateVoices(){ voices = synth.getVoices(); const sel = document.getElementById('voices'); sel.innerHTML=''; voices.forEach((v,i)=>{ const o=document.createElement('option'); o.value=i; o.textContent = v.name + ' — ' + v.lang; sel.appendChild(o); }); }
populateVoices();
if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = populateVoices;
document.getElementById('speak').addEventListener('click', ()=>{
  const text = document.getElementById('text').value;
  if (!text) return;
  synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  const vi = document.getElementById('voices').value;
  if (voices[vi]) u.voice = voices[vi];
  u.rate = parseFloat(document.getElementById('rate').value || '1');
  synth.speak(u);
});
document.getElementById('stop').addEventListener('click', ()=> synth.cancel());

/* Notes */
${notes ? `function loadNotes(){ const ns = JSON.parse(localStorage.getItem('gen_notes')||'[]'); const wrap=document.getElementById('notesList'); wrap.innerHTML=''; ns.forEach((n,i)=>{ const d=document.createElement('div'); d.textContent = n.title; d.style.padding='6px'; d.style.border='1px solid rgba(255,255,255,0.03)'; d.style.borderRadius='6px'; d.style.marginBottom='6px'; wrap.appendChild(d); }); }
document.getElementById('saveNote').addEventListener('click', ()=>{ const ns = JSON.parse(localStorage.getItem('gen_notes')||'[]'); ns.unshift({title: new Date().toLocaleString(), text: document.getElementById('text').value}); localStorage.setItem('gen_notes', JSON.stringify(ns.slice(0,50))); loadNotes(); });
loadNotes();` : ''}

/* Recorder */
${recorder ? `let mr, chunks=[];
document.getElementById('recStart').addEventListener('click', async ()=>{ const s = await navigator.mediaDevices.getUserMedia({audio:true}); mr = new MediaRecorder(s); chunks=[]; mr.ondataavailable = e=>chunks.push(e.data); mr.onstop = ()=>{ const b = new Blob(chunks,{type:'audio/webm'}); const url = URL.createObjectURL(b); const a = document.createElement('a'); a.href=url; a.download='rec.webm'; a.textContent='Download rec'; const wrap=document.getElementById('recs'); wrap.prepend(a); } ; mr.start(); });
document.getElementById('recStop').addEventListener('click', ()=> mr && mr.state !== 'inactive' && mr.stop());` : ''}

/* Speech-to-text (Web Speech API) */
${stt ? `let rec=null;
if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window){ const Rec = window.SpeechRecognition || window.webkitSpeechRecognition; rec = new Rec(); rec.continuous = true; rec.interimResults = true; rec.lang = navigator.language || 'en-US'; rec.onresult = ev=>{ let final=''; for(let i=ev.resultIndex;i<ev.results.length;++i){ if(ev.results[i].isFinal) final += ev.results[i][0].transcript; } if(final) { const ta = document.getElementById('text'); ta.value += (ta.value? '\\n':'') + final; } }; rec.onstart = ()=> document.getElementById('sttStatus').textContent='STT: listening'; rec.onend = ()=> document.getElementById('sttStatus').textContent='STT: idle'; }
document.getElementById('sttStart').addEventListener('click', ()=> rec && rec.start()); document.getElementById('sttStop').addEventListener('click', ()=> rec && rec.stop());` : ''}

</script>
</body>
</html>`;
}

genBtn.addEventListener('click', async ()=>{
  const name = document.getElementById('appName').value || 'My TTS App';
  const desc = document.getElementById('appDesc').value || '';
  const color = document.getElementById('appColor').value || '#06b6d4';
  const notes = document.getElementById('featNotes').checked;
  const recorder = document.getElementById('featRecorder').checked;
  const stt = document.getElementById('featSTT').checked;
  const zipName = document.getElementById('zipName').value || 'my-tts-app.zip';

  status.textContent = 'Building zip...';
  const zip = new JSZip();
  const opts = {name, desc, color, notes, recorder, stt};
  const index = makeIndexHTML(opts);
  zip.file('index.html', index);
  // add manifest
  const manifest = {
    name: name,
    short_name: name.slice(0,12),
    start_url: '.',
    display: 'standalone',
    background_color: '#061021',
    theme_color: color,
    icons: [{src:'icon.svg', sizes:'192x192', type:'image/svg+xml'}]
  };
  zip.file('manifest.json', JSON.stringify(manifest, null, 2));
  // add a simple icon
  const iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="192" height="192"><rect width="100%" height="100%" rx="24" fill="${color}"/><text x="50%" y="52%" font-size="48" font-family="Arial" fill="#041024" text-anchor="middle" alignment-baseline="middle">${name.charAt(0)||'A'}</text></svg>`;
  zip.file('icon.svg', iconSvg);

  // create zip and offer download
  const content = await zip.generateAsync({type:'blob'});
  const url = URL.createObjectURL(content);
  downloadArea.innerHTML = '';
  const a = document.createElement('a');
  a.href = url;
  a.download = zipName;
  a.textContent = 'Download ZIP — ' + zipName;
  a.style.display = 'inline-block';
  a.style.marginTop = '8px';
  downloadArea.appendChild(a);

  preview.textContent = index.slice(0, 2000) + (index.length>2000 ? "\n\n... (truncated)":"");
  status.textContent = 'Ready — ZIP generated in browser (no server).';
});
</script>
</body>
</html>
