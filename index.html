<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cemza Assistant ‚Äî Offline</title>
<style>
:root{
  --bg1:#030519; --bg2:#071227;
  --accent1:#7f5eff; --accent2:#57e8ff;
  --card: rgba(255,255,255,0.03);
  --text:#eaf6ff; --muted:#95adbf;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background: linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
.center{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px;}
.app{
  width:100%; max-width:820px; border-radius:18px; padding:22px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));
  border:1px solid rgba(255,255,255,0.02);
  box-shadow: 0 18px 60px rgba(2,8,24,0.6);
  position:relative; overflow:hidden;
}
.app::after{
  content:""; position:absolute; right:-120px; top:-120px; width:420px; height:420px;
  border-radius:50%; filter:blur(80px); opacity:0.08;
  background: linear-gradient(135deg, var(--accent2), transparent);
  pointer-events:none;
}
.header{display:flex; gap:16px; align-items:center}
.logo{width:84px; height:84px; border-radius:16px; display:flex;align-items:center;justify-content:center;
  font-size:40px; background: linear-gradient(135deg,var(--accent1),var(--accent2)); color:#041427;
  box-shadow:0 8px 26px rgba(127,94,255,0.12); animation:floaty 5s ease-in-out infinite;}
.title{display:flex;flex-direction:column}
.h1{margin:0;font-size:24px;font-weight:700;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.subtitle{margin:0;color:var(--muted);font-size:13px}
.controls{margin-top:18px; display:flex; gap:12px; align-items:center; justify-content:space-between}
.leftControls{display:flex; gap:12px; flex:1; align-items:center}
.input{flex:1; padding:14px 16px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  border:1px solid rgba(255,255,255,0.03); color:var(--text); font-size:15px; outline:none}
.btnPrimary{padding:12px 14px; border-radius:12px; border:none; background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#041427; font-weight:800; cursor:pointer}
.smallBtn{padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:var(--text); cursor:pointer}
.appButtons{margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
.appBtn{flex:1; min-width:160px; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03);
  background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); color:var(--text); font-weight:700; cursor:pointer}
.reply{margin-top:18px; min-height:120px; border-radius:12px; padding:16px; background: linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
  border:1px solid rgba(255,255,255,0.02); font-size:15px; line-height:1.5; overflow-wrap:break-word; position:relative}
.waveWrap{position:absolute; right:18px; top:18px; width:120px; height:48px; display:flex; align-items:center; justify-content:center}
.canvas{width:100%; height:48px;}
.footer{margin-top:12px; display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:13px}
.caret{display:inline-block;width:10px; animation:blink 1s steps(2) infinite; vertical-align:bottom}
@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}
@keyframes floaty{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
@media (max-width:720px){ .header{flex-direction:row; gap:12px} .waveWrap{display:none} .controls{flex-direction:column} .appButtons{flex-direction:column} }
kbd{background:rgba(255,255,255,0.04); padding:2px 6px; border-radius:6px; font-weight:600; color:var(--muted)}
.small{font-size:13px; color:var(--muted)}
</style>
</head>
<body>
  <div class="center">
    <main class="app" role="main" aria-label="Cemza Assistant (offline)">
      <header class="header">
        <div class="logo" aria-hidden="false">üêê</div>
        <div class="title">
          <div class="h1">Cemza Assistant</div>
          <div class="subtitle">Fully offline ‚Äî local Q&A, local recorder, app-first links</div>
        </div>
        <div class="waveWrap" title="voice activity">
          <canvas id="wave" class="canvas" width="300" height="48" aria-hidden="true"></canvas>
        </div>
      </header>

      <section class="controls" aria-label="controls">
        <div class="leftControls">
          <input id="query" class="input" placeholder="Ask about Cemza, or type 'open YouTube' / 'open Facebook' / 'open Instagram'">
          <button id="ask" class="btnPrimary">Ask</button>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          <button id="recStart" class="smallBtn">Record</button>
          <button id="recStop" class="smallBtn" disabled>Stop</button>
        </div>
      </section>

      <nav class="appButtons" aria-label="open apps">
        <button id="btnYT" class="appBtn">Open YouTube</button>
        <button id="btnFB" class="appBtn">Open Facebook / Facebook Lite</button>
        <button id="btnIG" class="appBtn">Open Instagram / Instagram Lite</button>
      </nav>

      <article id="reply" class="reply" aria-live="polite">Ready ‚Äî ask me about Cemza or record a short message. If you want speech-to-text offline, integrate an offline STT engine in your packaged app.</article>

      <div class="footer">
        <div id="voiceStatus">Voice: male (device TTS if available)</div>
        <div style="display:flex;gap:10px;align-items:center">
          <button id="download" class="appBtn" style="min-width:160px">Download 250 Q&A</button>
        </div>
      </div>
    </main>
  </div>

<script>
/* ============================
   OFFLINE CEMSZA ASSISTANT
   - fully offline Q&A (250)
   - local recorder (no STT)
   - TTS uses local device voices if present
   - app intents attempt to open installed apps; no web fallback (offline-safe)
   ============================ */

/* ---- facts (single source) ---- */
const FACTS = {
  stageName: "Cemza the goat",
  realName: "Xolisa Mandla",
  origin: "Cape Town, South Africa",
  creator: "Cemza the goat",
  createdByNote: "He asked his brother Xolani to create me.",
  likes: "creating music for fans",
  musicStatus: "keeps his music low profile ‚Äî prefers careful releases",
  socials: {
    youtube: "https://youtube.com/@cemzathegoat-j5s?si=A2xXwfYzHW9rAt8c",
    facebook: "https://www.facebook.com/cemza.thegoat",
    instagram: "https://www.instagram.com/cemzathegoat?igsh=YzljYTk1ODg3Zg=="
  }
};

/* ---- build 250 Q/A offline store ---- */
function makeVariations(baseList, count){
  const prefixes = ["", "Hey,", "Hi,", "Hello,", "Please,", "Quick:", "Tell me,"];
  const suffixes = ["", "?", " please", " now", " please?"];
  const out = [];
  for(const base of baseList){
    for(const p of prefixes){
      for(const s of suffixes){
        out.push((p + " " + base + s).trim());
        if(out.length >= count) return out;
      }
    }
  }
  let k=1;
  while(out.length < count){
    out.push(baseList[(k-1)%baseList.length] + " variant " + k);
    k++;
  }
  return out;
}

const cemzaTemplates = [
  "Who is Cemza?",
  "What is Cemza's real name?",
  "Where is Cemza from?",
  "What does Cemza like?",
  "Who created the Cemza AI?",
  "How did Cemza create the AI?",
  "Is Cemza a rapper?",
  "Does Cemza release music?",
  "Where can I find Cemza online?",
  "Does Cemza have YouTube?",
  "Does Cemza have Instagram?",
  "Does Cemza have Facebook?",
  "Tell me about Cemza",
  "When will Cemza release music?",
  "Why does Cemza keep his music low profile?",
  "What kind of music does Cemza make?",
  "Who is Xolisa Mandla?",
  "Who is Xolani?",
  "Who asked Xolani to build the AI?",
  "What is Cemza's stage name?"
];
const aiTemplates = [
  "Who are you?",
  "What can you do?",
  "Are you friendly?",
  "Who coded you?",
  "Will you have a voice?",
  "Can you open apps?",
  "Can you learn?",
  "Do you sleep?",
  "Are you alive?",
  "Why were you created?"
];

const cemzaQuestions = makeVariations(cemzaTemplates, 200);
const aiQuestions = makeVariations(aiTemplates, 50);
const allPairs = [];

function answerFor(q){
  const s = q.toLowerCase();
  if(/who is cemza|tell me about cemza|what is cemza's stage name/.test(s)) {
    return `${FACTS.stageName} ‚Äî real name ${FACTS.realName} ‚Äî is a rapper from ${FACTS.origin}. He likes ${FACTS.likes} and ${FACTS.musicStatus}.`;
  }
  if(/real name|xolisa/.test(s)) return `His real name is ${FACTS.realName}.`;
  if(/where.*from|origin/.test(s)) return `${FACTS.stageName} is from ${FACTS.origin}.`;
  if(/what does.*like|what.*like|likes/.test(s)) return `He likes ${FACTS.likes}.`;
  if(/who created.*ai|who created you|who made you|who coded you/.test(s)) return `${FACTS.creator} created me. ${FACTS.createdByNote}`;
  if(/how did.*create|how were you created|how did he create/.test(s)) return `${FACTS.createdByNote} They built me to help fans learn about Cemza and protect his image.`;
  if(/is cemza .*rapper|is .*a rapper/.test(s)) return `Yes ‚Äî ${FACTS.stageName} is a rapper from ${FACTS.origin}.`;
  if(/does.*release.*music|release music|released|when will cemza release/.test(s)) return `Cemza keeps his music low profile and prefers careful releases.`;
  if(/where can i find cemza|where.*online|social|youtube|instagram|facebook/.test(s)) return `You can find Cemza on YouTube, Facebook, and Instagram. Use the app buttons to open those apps and search "Cemza the goat".`;
  if(/kind of music|type of music|style of music/.test(s)) return `Cemza focuses on rap and soulful music that speaks to real life and the streets of Cape Town.`;
  if(/who is xolani/.test(s)) return `Xolani is Cemza's brother ‚Äî the person who coded and built this AI.`;
  if(/why does cemza keep|low profile/.test(s)) return `He prefers to craft his sound privately so each release matches his standards.`;
  if(/give me (a )?quote|quote from cemza|music quote/.test(s)){
    const quotes = [
      "Life's a beat ‚Äî I just find the rhythm and make it louder.",
      "Studio lights and late nights, that's where the truth comes out.",
      "I don't chase fame, I chase a feeling ‚Äî the rest follows.",
      "I write for the street, the soul, and the ones who never gave up.",
      "Beat drops, heart stops ‚Äî then the story keeps going."
    ];
    return quotes[Math.floor(Math.random()*quotes.length)];
  }
  /* AI self */
  if(/who are you/.test(s)) return `I am Cemza Assistant ‚Äî a friendly assistant created to share info about ${FACTS.stageName}.`;
  if(/what can you do|what do you do/.test(s)) return `I answer questions about ${FACTS.stageName}, open his social apps, and speak my replies out loud.`;
  if(/will you have a voice|when will you have a voice/.test(s)) return `Don't worry my friend, Xolani who is Cemza's brother will upgrade me soon and you will hear my voice.`;
  if(/can you open apps|open youtube|open facebook|open instagram/.test(s)) return `Yes ‚Äî use the YouTube, Facebook or Instagram buttons and I will try to open the installed app and search "Cemza the goat".`;
  if(/are you friendly/.test(s)) return `Yes ‚Äî I'm designed to be friendly, respectful, and protective of ${FACTS.stageName}'s image.`;
  if(/do you sleep|do you get tired/.test(s)) return `No ‚Äî I'm a digital assistant and I'm ready whenever you are.`;
  if(/can you learn/.test(s)) return `I can be updated by Xolani to improve my knowledge and behavior over time.`;
  if(/are you human/.test(s)) return `No ‚Äî I'm an AI assistant, built with code to help fans learn about ${FACTS.stageName}.`;
  if(/why were you created/.test(s)) return `I was created to help people learn about ${FACTS.stageName} and to share official social links while protecting his privacy.`;
  return null;
}

cemzaQuestions.forEach(q => allPairs.push({q:q, a: answerFor(q) || `Sorry, I don't know the answer to that question ‚Äî perhaps you might find out yourself. Try opening YouTube, Facebook or Instagram.`}));
aiQuestions.forEach(q => allPairs.push({q:q, a: answerFor(q) || `Sorry, I don't know the answer to that question ‚Äî perhaps you might find out yourself. Try opening YouTube, Facebook or Instagram.`}));

/* friendly map */
const friendlyMap = {
  "hello":"Hey ‚Äî good to see you!",
  "hi":"Hi ‚Äî how can I help you today?",
  "hey":"Hey! What's up?",
  "how are you":"I'm here and ready to help!",
  "how are you?":"I'm good ‚Äî thanks for asking!",
  "bye":"Goodbye ‚Äî stay inspired!",
  "goodbye":"Goodbye ‚Äî see you soon!",
  "good morning":"Good morning ‚Äî have a great day!",
  "good night":"Good night ‚Äî rest well!"
};

/* short-term memory (pronoun resolution) */
let memory = { lastSubject: null, lastQ: null, history: [] };
function resolvePronouns(text){
  if(!memory.lastSubject) return text;
  return text.replace(/\bhe\b/gi, memory.lastSubject)
             .replace(/\bhim\b/gi, memory.lastSubject)
             .replace(/\bhis\b/gi, memory.lastSubject + "'s");
}

/* UI elements */
const replyEl = document.getElementById('reply');
const queryEl = document.getElementById('query');
const askBtn = document.getElementById('ask');
const recStart = document.getElementById('recStart');
const recStop = document.getElementById('recStop');
const waveCanvas = document.getElementById('wave');
const waveCtx = waveCanvas.getContext('2d');
let mediaRecorder = null, recordedBlobs = [], localStream = null;

/* TTS male voice selection (device-local if available) */
function pickMaleVoice(){
  if(!('speechSynthesis' in window)) return null;
  const voices = window.speechSynthesis.getVoices();
  if(!voices || voices.length===0) return null;
  const maleHints = /male|man|david|john|alex|matt|michael|daniel|mark|tom|nick|paul|en-us/i;
  let v = voices.find(v => maleHints.test(v.name));
  if(!v) v = voices.find(v => /en|english/i.test(v.lang));
  return v || voices[0];
}

function speakText(text){
  if(!('speechSynthesis' in window)) return;
  try{
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const v = pickMaleVoice();
    if(v) u.voice = v;
    u.rate = 1;
    u.pitch = 1.0;
    u.volume = 1;
    u.onstart = ()=> startWaveSim();
    u.onend = ()=> stopWave();
    window.speechSynthesis.speak(u);
  }catch(e){ console.log('TTS error', e); }
}

/* typing + speak */
function typeAndSpeak(text){
  replyEl.textContent = "";
  let i=0;
  const speed = 14;
  const caret = document.createElement('span'); caret.className='caret'; caret.textContent='‚ñå';
  replyEl.appendChild(caret);
  const timer = setInterval(()=> {
    if(i < text.length){
      caret.insertAdjacentText('beforebegin', text.charAt(i));
      i++;
    } else {
      clearInterval(timer);
      if(caret.parentNode) caret.parentNode.removeChild(caret);
    }
  }, speed);
  speakText(text);
}

/* Answer finding */
function findAnswer(raw){
  if(!raw) return null;
  let norm = raw.trim();
  norm = resolvePronouns(norm);
  const low = norm.toLowerCase();
  if(/^(open youtube|open yt|youtube open)/.test(low)) return {cmd:'youtube'};
  if(/^(open facebook|open fb|facebook open)/.test(low)) return {cmd:'facebook'};
  if(/^(open instagram|open ig|instagram open)/.test(low) ) return {cmd:'instagram'};
  if(friendlyMap[low]) return {answer: friendlyMap[low]};
  for(const p of allPairs) if(p.q.toLowerCase() === low) return {answer: p.a};
  for(const p of allPairs){ const k = p.q.toLowerCase(); if(k.includes(low) || low.includes(k)) return {answer: p.a}; }
  const gen = answerFor(norm);
  if(gen) return {answer: gen};
  return null;
}

/* handle Ask */
askBtn.addEventListener('click', handleAsk);
queryEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleAsk(); });

function handleAsk(){
  const raw = (queryEl.value || "").trim();
  if(!raw) return;
  queryEl.value = "";
  memory.history.push({from:'user', text:raw});
  memory.lastQ = raw;
  const res = findAnswer(raw);
  if(!res){
    const fallback = "Sorry, I don't know the answer to that question ‚Äî perhaps you might find out yourself. Use the app buttons to open installed apps.";
    typeAndSpeak(fallback);
    memory.history.push({from:'assistant', text:fallback});
    return;
  }
  if(res.cmd){
    if(res.cmd === 'youtube'){ openYouTube(); typeAndSpeak("Trying to open YouTube on this device."); }
    if(res.cmd === 'facebook'){ openFacebook(); typeAndSpeak("Trying to open Facebook (or Facebook Lite) on this device."); }
    if(res.cmd === 'instagram'){ openInstagram(); typeAndSpeak("Trying to open Instagram (or Instagram Lite) on this device."); }
    memory.history.push({from:'assistant', text:'Opened app command: ' + res.cmd});
    return;
  }
  if(/cemza|xolisa|the goat/.test(res.answer.toLowerCase())) memory.lastSubject = FACTS.stageName;
  typeAndSpeak(res.answer);
  memory.history.push({from:'assistant', text:res.answer});
}

/* --------------- Recorder (local only) --------------- */
recStart.addEventListener('click', startRecording);
recStop.addEventListener('click', stopRecording);

async function startRecording(){
  // request mic and start MediaRecorder; waveform animates from mic input
  try {
    localStream = await navigator.mediaDevices.getUserMedia({audio:true});
  } catch (e) {
    typeAndSpeak("Microphone access denied or not available on this browser.");
    return;
  }
  recordedBlobs = [];
  const options = {mimeType: 'audio/webm'};
  try {
    mediaRecorder = new MediaRecorder(localStream, options);
  } catch (e) {
    mediaRecorder = new MediaRecorder(localStream);
  }
  mediaRecorder.ondataavailable = (event) => { if(event.data && event.data.size > 0) recordedBlobs.push(event.data); };
  mediaRecorder.onstop = onRecordingStop;
  mediaRecorder.start();
  recStart.disabled = true; recStop.disabled = false;
  startWaveFromMic(localStream);
  typeAndSpeak("Recording started ‚Äî speak now and press Stop when finished.");
}

function stopRecording(){
  if(mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
  recStart.disabled = false; recStop.disabled = true;
  stopWave();
}

function onRecordingStop(){
  // create a Blob URL and offer playback/download locally
  const blob = new Blob(recordedBlobs, {type: recordedBlobs[0]?.type || 'audio/webm'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const play = document.createElement('button');
  play.textContent = 'Play last recording';
  play.className = 'smallBtn';
  play.onclick = ()=> {
    const audio = new Audio(url);
    audio.onplay = startWaveSim;
    audio.onended = stopWave;
    audio.play();
  };
  a.textContent = 'Download recording';
  a.href = url;
  a.download = 'cemza_recording.webm';
  a.style.marginLeft = '10px';
  a.className = 'smallBtn';
  // show playback and download buttons in reply area
  replyEl.innerHTML = '';
  replyEl.appendChild(play);
  replyEl.appendChild(a);
  // stop mic tracks
  if(localStream){ localStream.getTracks().forEach(t=>t.stop()); localStream = null; }
}

/* waveform utilities */
let analyser = null, audioCtx = null, sourceNode = null, waveAnim = null;
function startWaveFromMic(stream){
  if(!stream) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  sourceNode = audioCtx.createMediaStreamSource(stream);
  sourceNode.connect(analyser);
  drawWave();
}
function drawWave(){
  const canvas = waveCanvas, ctx = waveCtx;
  const bufferLength = analyser.fftSize;
  const dataArray = new Uint8Array(bufferLength);
  function render(){
    waveAnim = requestAnimationFrame(render);
    analyser.getByteTimeDomainData(dataArray);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.lineWidth = 2; ctx.strokeStyle = "rgba(127,94,255,0.95)";
    ctx.beginPath();
    const slice = canvas.width / bufferLength;
    let x = 0;
    for(let i=0;i<bufferLength;i++){
      const v = dataArray[i]/128.0;
      const y = v * canvas.height/2;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      x += slice;
    }
    ctx.lineTo(canvas.width, canvas.height/2);
    ctx.stroke();
  }
  render();
}
function stopWave(){
  if(waveAnim) cancelAnimationFrame(waveAnim);
  waveCtx.clearRect(0,0,waveCanvas.width,waveCanvas.height);
  if(audioCtx){ try{ audioCtx.close(); } catch(e){} audioCtx = null; analyser = null; sourceNode = null; }
}
function startWaveSim(){
  // simple animated waveform during TTS playback
  const canvas = waveCanvas, ctx = waveCtx;
  let t = 0;
  function pulse(){
    waveAnim = requestAnimationFrame(pulse);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = "rgba(127,94,255,0.95)";
    for(let x=0;x<canvas.width;x++){
      const y = canvas.height/2 + Math.sin((x*0.02)+t)*(6 + Math.sin(t)*4);
      if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();
    t += 0.12;
  }
  pulse();
}

/* ---------------------------
   App opening (offline-safe)
   - Tries app via intent/uri
   - If not opened, shows message telling user to open the installed app manually
   - (No web fallback to keep offline)
   --------------------------- */
function openWithDetection(schemes, appName){
  let tried = 0, finished = false;
  function onVis(){ if(document.hidden) finished = true; }
  document.addEventListener('visibilitychange', onVis);
  function cleanup(){ document.removeEventListener('visibilitychange', onVis); }
  function attempt(){
    if(finished){ cleanup(); showOfflineAppNotOpened(appName); return; }
    if(tried >= schemes.length){ cleanup(); showOfflineAppNotOpened(appName); return; }
    const uri = schemes[tried++];
    try{
      if(uri.startsWith('intent:') || uri.startsWith('app:') || uri.startsWith('fb:') || uri.startsWith('instagram:') || uri.startsWith('vnd:') || uri.startsWith('youtube:')){
        // Setting location.href will cause browser to attempt to open the app
        window.location.href = uri;
      } else {
        // try iframe for custom schemes
        const ifr = document.createElement('iframe'); ifr.style.display='none'; ifr.src = uri; document.body.appendChild(ifr);
        setTimeout(()=>{ try{ document.body.removeChild(ifr); } catch(e){} }, 900);
      }
    }catch(e){}
    setTimeout(()=>{
      if(document.hidden){ finished = true; cleanup(); return; }
      attempt();
    }, 900);
  }
  attempt();
}

function showOfflineAppNotOpened(appName){
  const msg = `I couldn't open the ${appName} app on this device. If it's installed, try opening it manually and search "Cemza the goat".`;
  typeAndSpeak(msg);
}

/* YouTube (tries app schemes) */
function openYouTube(){
  const q = encodeURIComponent('Cemza the goat');
  const schemes = [
    `intent://www.youtube.com/results?search_query=${q}#Intent;package=com.google.android.youtube;scheme=https;end;`,
    `vnd.youtube://results?search_query=${q}`,
    `youtube://www.youtube.com/results?search_query=${q}`
  ];
  openWithDetection(schemes, 'YouTube');
}

/* Facebook (tries Lite then main) */
function openFacebook(){
  const q = encodeURIComponent('Cemza the goat');
  const schemes = [
    `intent://www.facebook.com/search/top/?q=${q}#Intent;package=com.facebook.lite;scheme=https;end;`,
    `intent://www.facebook.com/search/top/?q=${q}#Intent;package=com.facebook.katana;scheme=https;end;`,
    `fb://search/?q=${q}`
  ];
  openWithDetection(schemes, 'Facebook / Facebook Lite');
}

/* Instagram (tries Lite then main) */
function openInstagram(){
  const q = encodeURIComponent('Cemza the goat');
  const schemes = [
    `intent://instagram.com/_u/cemzathegoat#Intent;package=com.instagram.lite;scheme=https;end;`,
    `intent://instagram.com/_u/cemzathegoat#Intent;package=com.instagram.android;scheme=https;end;`,
    `instagram://user?username=cemzathegoat`,
    `instagram://search?query=${q}`
  ];
  openWithDetection(schemes, 'Instagram / Instagram Lite');
}

/* wire app buttons */
document.getElementById('btnYT').addEventListener('click', ()=>{ openYouTube(); typeAndSpeak("Attempting to open YouTube on this device."); });
document.getElementById('btnFB').addEventListener('click', ()=>{ openFacebook(); typeAndSpeak("Attempting to open Facebook or Facebook Lite on this device."); });
document.getElementById('btnIG').addEventListener('click', ()=>{ openInstagram(); typeAndSpeak("Attempting to open Instagram or Instagram Lite on this device."); });

/* Download file */
document.getElementById('download').addEventListener('click', ()=>{
  let out = "250 Questions and Answers about Cemza (based only on provided information)\n\n";
  allPairs.forEach((p,i)=>{ out += (i+1)+". Q: "+p.q+"\n   A: "+p.a+"\n\n"; });
  const blob = new Blob([out], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='cemza_250_QA.txt'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
  typeAndSpeak("Downloaded Q and A file.");
});

/* Initial greeting (no online APIs) */
window.addEventListener('load', ()=> {
  // warm-up TTS voices (best-effort)
  if('speechSynthesis' in window) window.speechSynthesis.getVoices();
  typeAndSpeak("Welcome ‚Äî I am Cemza Assistant. Ask me about Cemza or open an installed app.");
});

/* clean up on unload */
window.addEventListener('beforeunload', ()=> { try{ if(localStream) localStream.getTracks().forEach(t=>t.stop()); } catch(e){} });
</script>
</body>
</html>